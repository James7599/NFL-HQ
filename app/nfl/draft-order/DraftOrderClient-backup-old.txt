'use client';

import { useMemo, useState, useEffect } from 'react';
import Image from 'next/image';
import { getAllTeams, TeamData } from '@/data/teams';
import NBATeamsSidebar from '@/components/NBATeamsSidebar';
import NBATeamModal from '@/components/NBATeamModal';
import LotterySimulator from '@/components/LotterySimulator';
import {
  loadAllTeamsDraftPicks,
  buildDraftBoard,
  getAllTeamPicksForYear,
  DraftBoardPick,
  TeamDraftPicks
} from '@/lib/draftPicksUtils';
import { lotterySimulator } from '@/lib/lotterySimulator';

// Map API team slugs to our team IDs
const teamSlugMapping: Record<string, string> = {
  'atlanta-hawks': 'atlanta-hawks',
  'boston-celtics': 'boston-celtics',
  'brooklyn-nets': 'brooklyn-nets',
  'charlotte-hornets': 'charlotte-hornets',
  'chicago-bulls': 'chicago-bulls',
  'cleveland-cavaliers': 'cleveland-cavaliers',
  'dallas-mavericks': 'dallas-mavericks',
  'denver-nuggets': 'denver-nuggets',
  'detroit-pistons': 'detroit-pistons',
  'golden-state-warriors': 'golden-state-warriors',
  'houston-rockets': 'houston-rockets',
  'indiana-pacers': 'indiana-pacers',
  'la-clippers': 'los-angeles-clippers',
  'los-angeles-clippers': 'los-angeles-clippers',
  'lakers': 'los-angeles-lakers',
  'los-angeles-lakers': 'los-angeles-lakers',
  'memphis-grizzlies': 'memphis-grizzlies',
  'miami-heat': 'miami-heat',
  'milwaukee-bucks': 'milwaukee-bucks',
  'minnesota-timberwolves': 'minnesota-timberwolves',
  'new-orleans-pelicans': 'new-orleans-pelicans',
  'new-york-knicks': 'new-york-knicks',
  'oklahoma-city-thunder': 'oklahoma-city-thunder',
  'orlando-magic': 'orlando-magic',
  'philadelphia-76ers': 'philadelphia-76ers',
  'phoenix-suns': 'phoenix-suns',
  'portland-trail-blazers': 'portland-trail-blazers',
  'portland-trailblazers': 'portland-trail-blazers',
  'sacramento-kings': 'sacramento-kings',
  'san-antonio-spurs': 'san-antonio-spurs',
  'toronto-raptors': 'toronto-raptors',
  'utah-jazz': 'utah-jazz',
  'washington-wizards': 'washington-wizards',
};

const DRAFT_YEAR = 2026; // Next draft

export default function DraftOrderClient() {
  const allTeams = getAllTeams();
  const [teamRecords, setTeamRecords] = useState<Map<string, string>>(new Map());
  const [allTeamsPicks, setAllTeamsPicks] = useState<Map<string, TeamDraftPicks>>(new Map());
  const [isLoadingStandings, setIsLoadingStandings] = useState(true);
  const [isLoadingPicks, setIsLoadingPicks] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [selectedTeam, setSelectedTeam] = useState<string | null>(null);

  // Fetch live standings for draft order projections
  useEffect(() => {
    async function fetchStandings() {
      try {
        setIsLoadingStandings(true);
        setError(null);

        const response = await fetch('/api/nba/standings?season=2025&level=conference');

        if (!response.ok) {
          throw new Error('Failed to fetch standings');
        }

        const data = await response.json();

        // Create a map of team ID to live record
        const recordsMap = new Map<string, string>();

        if (data.data?.standings?.conferences) {
          for (const conf of data.data.standings.conferences) {
            for (const team of conf.teams) {
              const teamId = teamSlugMapping[team.sk_slug] || team.sk_slug;
              const wins = team.wins || 0;
              const losses = team.losses || 0;
              recordsMap.set(teamId, `${wins}-${losses}`);
            }
          }
        }

        setTeamRecords(recordsMap);
      } catch (err) {
        console.error('Error fetching standings:', err);
        setError(err instanceof Error ? err.message : 'Failed to load standings');
      } finally {
        setIsLoadingStandings(false);
      }
    }

    fetchStandings();
  }, []);

  // Load all teams' draft picks data
  useEffect(() => {
    async function fetchDraftPicks() {
      try {
        setIsLoadingPicks(true);
        const picksData = await loadAllTeamsDraftPicks();
        setAllTeamsPicks(picksData);
      } catch (err) {
        console.error('Error loading draft picks:', err);
        setError(err instanceof Error ? err.message : 'Failed to load draft picks');
      } finally {
        setIsLoadingPicks(false);
      }
    }

    fetchDraftPicks();
  }, []);

  // Build draft board from actual pick ownership
  const draftBoard = useMemo(() => {
    if (allTeamsPicks.size === 0) return [];
    return buildDraftBoard(DRAFT_YEAR, allTeamsPicks, teamRecords);
  }, [allTeamsPicks, teamRecords]);

  // Group picks by round
  const picksByRound = useMemo(() => {
    const rounds: { [key: number]: DraftBoardPick[] } = { 1: [], 2: [] };
    draftBoard.forEach(pick => {
      if (pick.round === 1 || pick.round === 2) {
        rounds[pick.round].push(pick);
      }
    });
    return rounds;
  }, [draftBoard]);

  const isLoading = isLoadingStandings || isLoadingPicks;

  // Get selected team data and all their picks
  const selectedTeamData = useMemo(() => {
    if (!selectedTeam) return null;
    return allTeams.find(t => t.id === selectedTeam);
  }, [selectedTeam, allTeams]);

  const selectedTeamPicks = useMemo(() => {
    if (!selectedTeam) return [];
    return getAllTeamPicksForYear(selectedTeam, DRAFT_YEAR, allTeamsPicks, teamRecords);
  }, [selectedTeam, allTeamsPicks, teamRecords]);

  // Create lottery teams for simulator
  const lotteryTeams = useMemo(() => {
    if (teamRecords.size === 0) return [];
    return lotterySimulator.createLotteryTeams(allTeams, teamRecords);
  }, [allTeams, teamRecords]);

  return (
    <div className="flex h-screen bg-gray-50">
      {/* Sidebar */}
      <aside className="hidden lg:block lg:w-64 flex-shrink-0">
        <NBATeamsSidebar />
      </aside>

      {/* Mobile Sidebar */}
      <div className="lg:hidden fixed top-0 left-0 right-0 z-50">
        <NBATeamsSidebar isMobile={true} />
      </div>

      {/* Main Content */}
      <main className="flex-1 overflow-y-auto lg:pt-0 pt-14">
        {/* Header Section */}
        <div className="bg-[#FF6B35] text-white py-8 px-4 sm:px-6 lg:px-8 w-full">
          <div className="mx-auto max-w-7xl">
            <h1 className="text-2xl sm:text-3xl lg:text-4xl xl:text-5xl font-bold mb-2">
              {DRAFT_YEAR} NBA Draft Order
            </h1>
            <p className="text-base sm:text-lg lg:text-xl opacity-90">
              Complete draft order with actual pick ownership, trades, and protections
            </p>
          </div>
        </div>

        {/* Draft Picks Content */}
        <div className="mx-auto px-4 sm:px-6 lg:px-8 py-8 max-w-7xl">
          {/* Loading State */}
          {isLoading && (
            <div className="flex items-center justify-center py-12">
              <div className="text-center">
                <svg
                  className="animate-spin h-12 w-12 mx-auto mb-4 text-orange-500"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    className="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    strokeWidth="4"
                  />
                  <path
                    className="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  />
                </svg>
                <p className="text-gray-600 font-medium">Loading draft order...</p>
              </div>
            </div>
          )}

          {/* Error State */}
          {error && !isLoading && (
            <div className="bg-red-50 border border-red-200 rounded-lg p-6 mb-6">
              <div className="flex items-start gap-3">
                <svg className="w-6 h-6 text-red-600 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                  <h3 className="text-red-800 font-semibold mb-1">Failed to load draft data</h3>
                  <p className="text-red-600 text-sm">{error}</p>
                </div>
              </div>
            </div>
          )}

          {/* Draft Picks */}
          {!isLoading && [1, 2].map((round) => (
            <div key={round} className="mb-12">
              {/* Round Header */}
              <div className="bg-[#FF6B35] text-white px-6 py-4 rounded-t-lg mb-6">
                <h2 className="text-2xl font-bold">Round {round}</h2>
              </div>

              {/* Lottery Note - Only show for Round 1 */}
              {round === 1 && (
                <div className="mb-4 px-2 space-y-2">
                  <p className="text-sm text-gray-600">
                    <span className="inline-block w-4 h-4 border-2 border-yellow-400 rounded mr-2 align-middle"></span>
                    Yellow border indicates lottery picks (1-14)
                  </p>
                  <p className="text-sm text-gray-600">
                    <span className="inline-block w-4 h-4 border-2 border-blue-400 rounded mr-2 align-middle"></span>
                    Blue border indicates traded picks
                  </p>
                </div>
              )}

              {/* Picks Grid */}
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                {picksByRound[round]?.map((pick, index) => {
                  const isLotteryPick = round === 1 && pick.pickNumber <= 14;
                  const owningTeamRecord = teamRecords.get(pick.owningTeam.id) || pick.owningTeam.record || '0-0';

                  // Extract clean team abbreviation from "via TEAM" or complex strings
                  const getFromTeamAbbr = (fromStr: string): string => {
                    if (!fromStr || fromStr === 'Own') return '';
                    // Match "via TEAM" pattern
                    const viaMatch = fromStr.match(/via\s+([A-Z]{2,3})/i);
                    if (viaMatch) return viaMatch[1].toUpperCase();
                    // Match just team abbreviation
                    const abbrMatch = fromStr.match(/\b([A-Z]{2,3})\b/);
                    if (abbrMatch) return abbrMatch[1];
                    return fromStr;
                  };

                  const fromAbbr = getFromTeamAbbr(pick.from);

                  return (
                    <button
                      key={`${pick.pickNumber}-${pick.owningTeam.id}-${index}`}
                      onClick={() => setSelectedTeam(pick.owningTeam.id)}
                      className={`bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow overflow-hidden cursor-pointer text-left w-full ${
                        isLotteryPick ? 'border-2 border-yellow-400' : pick.isTraded ? 'border-2 border-blue-400' : ''
                      }`}
                    >
                      <div className="p-4">
                        <div className="flex items-center gap-4 mb-3">
                          {/* Pick Number Box */}
                          <div
                            className="flex-shrink-0 w-14 h-14 rounded flex items-center justify-center text-white text-2xl font-bold"
                            style={{ backgroundColor: pick.owningTeam.primaryColor }}
                          >
                            {pick.pickNumber}
                          </div>

                          {/* Team Info */}
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-1">
                              <Image
                                src={pick.owningTeam.logoUrl}
                                alt={pick.owningTeam.abbreviation}
                                width={32}
                                height={32}
                                className="w-8 h-8"
                              />
                              <div className="flex-1 min-w-0">
                                <div className="text-base font-semibold text-gray-900 truncate">
                                  {pick.owningTeam.abbreviation} ({owningTeamRecord})
                                </div>
                                <div className="text-sm text-gray-600">
                                  {pick.owningTeam.name}
                                </div>
                                {fromAbbr && (
                                  <div className="text-xs text-blue-600 font-medium mt-0.5">
                                    via {fromAbbr}
                                  </div>
                                )}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          ))}

          {/* Lottery Simulator */}
          {!isLoading && lotteryTeams.length > 0 && (
            <div className="mt-12">
              <LotterySimulator teams={lotteryTeams} />
            </div>
          )}

          {/* NBA Draft Lottery Odds Table */}
          <div className="mt-12 bg-white rounded-lg shadow-sm p-6 border border-gray-200">
            <h2 className="text-2xl font-bold text-gray-900 mb-2">NBA Draft Lottery Odds</h2>
            <p className="text-sm text-gray-600 mb-6">Probability of landing each pick position (based on record)</p>

            <div className="overflow-x-auto">
              <table className="w-full text-sm border-collapse">
                <thead>
                  <tr className="bg-[#FF6B35] text-white">
                    <th className="p-3 text-center font-bold border border-orange-400">SEED</th>
                    <th className="p-3 text-center font-bold border border-orange-400">1</th>
                    <th className="p-3 text-center font-bold border border-orange-400">2</th>
                    <th className="p-3 text-center font-bold border border-orange-400">3</th>
                    <th className="p-3 text-center font-bold border border-orange-400">4</th>
                    <th className="p-3 text-center font-bold border border-orange-400">5</th>
                    <th className="p-3 text-center font-bold border border-orange-400">6</th>
                    <th className="p-3 text-center font-bold border border-orange-400">7</th>
                    <th className="p-3 text-center font-bold border border-orange-400">8</th>
                    <th className="p-3 text-center font-bold border border-orange-400">9</th>
                    <th className="p-3 text-center font-bold border border-orange-400">10</th>
                    <th className="p-3 text-center font-bold border border-orange-400">11</th>
                    <th className="p-3 text-center font-bold border border-orange-400">12</th>
                    <th className="p-3 text-center font-bold border border-orange-400">13</th>
                    <th className="p-3 text-center font-bold border border-orange-400">14</th>
                    <th className="p-3 text-center font-bold border border-orange-400 bg-orange-600">AVG</th>
                  </tr>
                </thead>
                <tbody className="text-gray-700">
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">1</td>
                    <td className="p-3 text-center border border-gray-200">14.0</td>
                    <td className="p-3 text-center border border-gray-200">13.4</td>
                    <td className="p-3 text-center border border-gray-200">12.7</td>
                    <td className="p-3 text-center border border-gray-200">12.0</td>
                    <td className="p-3 text-center border border-gray-200">47.9</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">3.7</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">2</td>
                    <td className="p-3 text-center border border-gray-200">14.0</td>
                    <td className="p-3 text-center border border-gray-200">13.4</td>
                    <td className="p-3 text-center border border-gray-200">12.7</td>
                    <td className="p-3 text-center border border-gray-200">12.0</td>
                    <td className="p-3 text-center border border-gray-200">27.8</td>
                    <td className="p-3 text-center border border-gray-200">20.0</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">3.9</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">3</td>
                    <td className="p-3 text-center border border-gray-200">14.0</td>
                    <td className="p-3 text-center border border-gray-200">13.4</td>
                    <td className="p-3 text-center border border-gray-200">12.7</td>
                    <td className="p-3 text-center border border-gray-200">12.0</td>
                    <td className="p-3 text-center border border-gray-200">14.8</td>
                    <td className="p-3 text-center border border-gray-200">26.0</td>
                    <td className="p-3 text-center border border-gray-200">7.0</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">4.1</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">4</td>
                    <td className="p-3 text-center border border-gray-200">12.5</td>
                    <td className="p-3 text-center border border-gray-200">12.2</td>
                    <td className="p-3 text-center border border-gray-200">11.9</td>
                    <td className="p-3 text-center border border-gray-200">11.5</td>
                    <td className="p-3 text-center border border-gray-200">7.2</td>
                    <td className="p-3 text-center border border-gray-200">25.7</td>
                    <td className="p-3 text-center border border-gray-200">16.7</td>
                    <td className="p-3 text-center border border-gray-200">2.2</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">4.4</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">5</td>
                    <td className="p-3 text-center border border-gray-200">10.5</td>
                    <td className="p-3 text-center border border-gray-200">10.5</td>
                    <td className="p-3 text-center border border-gray-200">10.6</td>
                    <td className="p-3 text-center border border-gray-200">10.5</td>
                    <td className="p-3 text-center border border-gray-200">2.2</td>
                    <td className="p-3 text-center border border-gray-200">19.6</td>
                    <td className="p-3 text-center border border-gray-200">26.7</td>
                    <td className="p-3 text-center border border-gray-200">8.7</td>
                    <td className="p-3 text-center border border-gray-200">0.6</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">5.0</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">6</td>
                    <td className="p-3 text-center border border-gray-200">9.0</td>
                    <td className="p-3 text-center border border-gray-200">9.2</td>
                    <td className="p-3 text-center border border-gray-200">9.4</td>
                    <td className="p-3 text-center border border-gray-200">9.6</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">8.6</td>
                    <td className="p-3 text-center border border-gray-200">29.8</td>
                    <td className="p-3 text-center border border-gray-200">20.5</td>
                    <td className="p-3 text-center border border-gray-200">3.7</td>
                    <td className="p-3 text-center border border-gray-200">0.1</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">5.5</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">7</td>
                    <td className="p-3 text-center border border-gray-200">7.5</td>
                    <td className="p-3 text-center border border-gray-200">7.8</td>
                    <td className="p-3 text-center border border-gray-200">8.1</td>
                    <td className="p-3 text-center border border-gray-200">8.5</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">19.7</td>
                    <td className="p-3 text-center border border-gray-200">34.1</td>
                    <td className="p-3 text-center border border-gray-200">12.9</td>
                    <td className="p-3 text-center border border-gray-200">1.3</td>
                    <td className="p-3 text-center border border-gray-200">&gt;0.0</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">6.2</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">8</td>
                    <td className="p-3 text-center border border-gray-200">6.0</td>
                    <td className="p-3 text-center border border-gray-200">6.3</td>
                    <td className="p-3 text-center border border-gray-200">6.7</td>
                    <td className="p-3 text-center border border-gray-200">7.2</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">34.5</td>
                    <td className="p-3 text-center border border-gray-200">32.1</td>
                    <td className="p-3 text-center border border-gray-200">6.7</td>
                    <td className="p-3 text-center border border-gray-200">0.4</td>
                    <td className="p-3 text-center border border-gray-200">&gt;0.0</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">7.0</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">9</td>
                    <td className="p-3 text-center border border-gray-200">4.5</td>
                    <td className="p-3 text-center border border-gray-200">4.8</td>
                    <td className="p-3 text-center border border-gray-200">5.2</td>
                    <td className="p-3 text-center border border-gray-200">5.7</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">50.7</td>
                    <td className="p-3 text-center border border-gray-200">25.9</td>
                    <td className="p-3 text-center border border-gray-200">3.0</td>
                    <td className="p-3 text-center border border-gray-200">0.1</td>
                    <td className="p-3 text-center border border-gray-200">&gt;0.0</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">8.0</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">10</td>
                    <td className="p-3 text-center border border-gray-200">3.0</td>
                    <td className="p-3 text-center border border-gray-200">3.3</td>
                    <td className="p-3 text-center border border-gray-200">3.6</td>
                    <td className="p-3 text-center border border-gray-200">4.0</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">65.9</td>
                    <td className="p-3 text-center border border-gray-200">19.0</td>
                    <td className="p-3 text-center border border-gray-200">1.2</td>
                    <td className="p-3 text-center border border-gray-200">&gt;0.0</td>
                    <td className="p-3 text-center border border-gray-200">&gt;0.0</td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">9.2</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">11</td>
                    <td className="p-3 text-center border border-gray-200">2.0</td>
                    <td className="p-3 text-center border border-gray-200">2.2</td>
                    <td className="p-3 text-center border border-gray-200">2.4</td>
                    <td className="p-3 text-center border border-gray-200">2.8</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">77.6</td>
                    <td className="p-3 text-center border border-gray-200">12.6</td>
                    <td className="p-3 text-center border border-gray-200">0.4</td>
                    <td className="p-3 text-center border border-gray-200">&gt;0.0</td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">10.3</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">12</td>
                    <td className="p-3 text-center border border-gray-200">1.5</td>
                    <td className="p-3 text-center border border-gray-200">1.7</td>
                    <td className="p-3 text-center border border-gray-200">1.9</td>
                    <td className="p-3 text-center border border-gray-200">2.1</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">86.1</td>
                    <td className="p-3 text-center border border-gray-200">6.7</td>
                    <td className="p-3 text-center border border-gray-200">0.1</td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">11.4</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">13</td>
                    <td className="p-3 text-center border border-gray-200">1.0</td>
                    <td className="p-3 text-center border border-gray-200">1.1</td>
                    <td className="p-3 text-center border border-gray-200">1.2</td>
                    <td className="p-3 text-center border border-gray-200">1.4</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">92.9</td>
                    <td className="p-3 text-center border border-gray-200">2.3</td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">12.5</td>
                  </tr>
                  <tr className="hover:bg-gray-50">
                    <td className="p-3 text-center font-semibold border border-gray-200 bg-gray-50">14</td>
                    <td className="p-3 text-center border border-gray-200">0.5</td>
                    <td className="p-3 text-center border border-gray-200">0.6</td>
                    <td className="p-3 text-center border border-gray-200">0.6</td>
                    <td className="p-3 text-center border border-gray-200">0.7</td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200"></td>
                    <td className="p-3 text-center border border-gray-200">97.6</td>
                    <td className="p-3 text-center border border-gray-200 font-semibold bg-orange-50">13.7</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <p className="text-xs text-gray-500 mt-4">
              Percentages show the probability of each seed landing at each draft position.
            </p>
          </div>

          {/* Lottery Explanation Section */}
          <div className="mt-12 space-y-8">
            {/* How Does the NBA Draft Lottery Work? */}
            <div className="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">
                How Does the NBA Draft Lottery Work?
              </h2>
              <div className="prose prose-gray max-w-none">
                <p className="text-gray-700 leading-relaxed mb-4">
                  The NBA Draft Lottery determines the order of selection for the first 14 picks in the NBA Draft.
                  It includes the 14 teams that did not make the playoffs in the previous season.
                </p>
                <p className="text-gray-700 leading-relaxed mb-4">
                  Each team is assigned a certain number of combinations based on their regular season record.
                  The three teams with the worst records each have a 14.0% chance of winning the #1 pick.
                  Odds then decrease for teams with better records (12.5% for 4th worst, 10.5% for 5th worst,
                  down to 0.5% for the 14th team). The lottery uses 14 numbered ping-pong balls (1-14)
                  to create 1,000 possible four-ball combinations that are distributed among the 14 teams.
                </p>
                <p className="text-gray-700 leading-relaxed mb-4">
                  During the drawing, the balls are mixed for 20 seconds before the first ball is drawn,
                  then for 10 seconds between each of the remaining three balls. Four balls are drawn to
                  create a four-digit combination that determines which team receives that pick.
                  This process is repeated to determine picks 1 through 4 only.
                </p>
                <p className="text-gray-700 leading-relaxed">
                  After the top four picks are determined by lottery, the remaining lottery teams
                  (picks 5-14) are assigned in inverse order of their regular season records.
                  The entire process is overseen by representatives from Ernst & Young LLP to ensure
                  integrity and transparency.
                </p>
              </div>
            </div>

            {/* NBA Draft Tiebreakers */}
            <div className="bg-white rounded-lg shadow-sm p-6 border border-gray-200">
              <h2 className="text-2xl font-bold text-gray-900 mb-4">
                NBA Draft Tiebreakers
              </h2>
              <div className="prose prose-gray max-w-none">
                <p className="text-gray-700 leading-relaxed mb-4">
                  When two or more teams finish the regular season with identical records, the NBA uses
                  random drawings to determine their draft order. These drawings take place at NBA
                  headquarters and are overseen by a representative from Ernst & Young to ensure impartiality.
                </p>
                <p className="text-gray-700 leading-relaxed mb-4">
                  <strong>For Lottery Teams (Non-Playoff Teams):</strong> When multiple lottery teams
                  have the same record, all of their assigned lottery combinations are pooled together
                  and then split evenly among them. If the total number of combinations cannot be divided
                  equally, a random drawing determines which team(s) receive the extra combination(s).
                </p>
                <p className="text-gray-700 leading-relaxed mb-4">
                  <strong>For Non-Lottery Teams (Playoff Teams):</strong> The random drawing directly
                  determines the order these teams will pick in the draft. Among playoff teams, those
                  who advance further in the playoffs pick later, with the NBA champion selecting last
                  at pick #30.
                </p>
                <p className="text-gray-700 leading-relaxed mb-4">
                  <strong>Second Round Order:</strong> An important note is that tiebreaker results
                  are reversed in the second round. If Team A wins a tiebreaker over Team B and picks
                  ahead in the first round, Team B will pick ahead of Team A in the second round.
                </p>
                <div className="bg-blue-50 border-l-4 border-blue-500 p-4 mt-4">
                  <p className="text-sm font-medium text-blue-900 mb-2">
                    Note on Current Draft Order Projections
                  </p>
                  <p className="text-sm text-blue-800">
                    Official tiebreaker drawings for the {DRAFT_YEAR} NBA Draft have not yet been conducted
                    (they occur in April after the regular season ends). For teams with identical records,
                    our current projections use alphabetical order as a consistent placeholder. The actual
                    draft order for tied teams will be determined by random drawing at NBA headquarters
                    under Ernst & Young supervision.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      {/* Team Details Modal */}
      {selectedTeam && selectedTeamData && (
        <NBATeamModal
          isOpen={!!selectedTeam}
          onClose={() => setSelectedTeam(null)}
          team={selectedTeamData}
          picks={selectedTeamPicks}
          record={teamRecords.get(selectedTeam)}
        />
      )}
    </div>
  );
}
